# 🎮 五子棋AI小程序 - 完整说明文档

## 📋 目录

1. [项目概述](#项目概述)
2. [功能特性](#功能特性)
3. [快速开始](#快速开始)
4. [免费部署方案](#免费部署方案)
5. [AI智能系统](#ai智能系统)
6. [游戏功能详解](#游戏功能详解)
7. [常见问题解决](#常见问题解决)
8. [技术架构](#技术架构)
9. [开发指南](#开发指南)
10. [更新日志](#更新日志)

---

## 📖 项目概述

### 🎯 项目简介
这是一个功能完整的五子棋微信小程序，采用Python Flask后端 + 微信小程序前端的架构。玩家可以与智能AI进行对战，AI具备多个难度等级和智能思考能力。

### 🌟 主要特点
- ✅ **智能AI对战**：支持5个难度等级（简单到大师）
- ✅ **可调节AI速度**：5种思考速度（极速到深思）
- ✅ **提示功能**：每局限用1次的AI提示
- ✅ **完整游戏逻辑**：标准五子棋规则，胜负判断
- ✅ **友好界面**：清晰的棋盘显示，避开棋盘的弹窗提示
- ✅ **免费部署**：支持Railway等免费云平台部署

---

## 🎮 功能特性

### 🎯 **游戏核心功能**

#### 1. **智能AI对战**
- **5个难度等级**：
  - 🟢 **简单**：搜索深度2层，适合初学者
  - 🔵 **普通**：搜索深度3层，休闲对弈
  - 🟡 **困难**：搜索深度4层，需要认真思考
  - 🟠 **专家**：搜索深度6层，真正的挑战
  - 🔴 **大师**：搜索深度8层，极限难度

#### 2. **AI思考速度控制**
- **5种速度设置**：
  - ⚡ **极速**：0.2秒思考
  - 🚀 **快速**：0.8秒思考
  - 🐾 **普通**：1.5秒思考
  - 🐌 **慢速**：2.5秒思考
  - 🧠 **深思**：4.0秒思考

#### 3. **提示系统**
- **每局限用1次**：策略性使用提示
- **智能推荐**：AI分析当前最佳落子位置
- **使用限制**：防止过度依赖，提升技能
- **状态显示**：按钮显示剩余次数

#### 4. **界面优化**
- **避开棋盘的弹窗**：所有提示都在棋盘上方显示
- **AI落子高亮**：特殊动画显示AI落子位置和思考时间
- **清晰的状态提示**：实时显示游戏状态和回合信息

### 🛠️ **辅助功能**

#### 1. **游戏控制**
- **新游戏**：创建新的游戏会话
- **重置游戏**：重置当前游戏到初始状态
- **状态同步**：手动同步前后端游戏状态
- **难度调整**：游戏外可调整AI难度

#### 2. **错误处理**
- **网络异常处理**：自动重试和错误提示
- **状态不同步修复**：提供同步按钮
- **防重复点击**：避免网络问题导致的重复操作

---

## 🚀 快速开始

### 💻 **本地开发运行**

#### 1. **启动后端服务**
```bash
# 方法1：直接启动
python miniprogram.py

# 方法2：使用启动脚本
python run.py

# 默认运行在 http://localhost:5001
```

#### 2. **配置微信开发者工具**
1. 下载安装微信开发者工具
2. 导入项目目录下的 `miniprogram` 文件夹
3. **重要配置**：
   - 在"本地设置"中勾选"不校验合法域名..."
   - 勾选"启用调试"
   - 确保 `project.config.json` 中 `urlCheck: false`

#### 3. **开始游戏**
1. 点击"新游戏"创建游戏
2. 选择合适的AI难度和速度
3. 开始与AI对战！

### 🧪 **测试功能**
```bash
# 运行后端健康检查
python diagnose_game.py

# 运行游戏逻辑测试
python test_game.py
```

---

## 🆓 免费部署方案

### 🌟 **推荐方案：Railway（完全免费）**

#### 优势
- ✅ **每月500小时**免费运行时间
- ✅ **自动HTTPS证书**
- ✅ **免费域名**：yourapp.railway.app
- ✅ **自动部署**：连接GitHub自动更新

#### 部署步骤

1. **准备代码**：
```bash
# 运行一键部署脚本
./免费部署一键脚本.sh
```

2. **Railway部署**：
   - 访问 https://railway.app/
   - 用GitHub账号登录
   - 选择"Deploy from GitHub repo"
   - 选择你的仓库，自动部署！

3. **获取免费域名**：
   - 部署完成后获得免费域名
   - 如：`wuziqi-production.railway.app`

#### 微信小程序配置
```javascript
// 更新 miniprogram/app.js
globalData: {
  serverUrl: 'https://yourapp.railway.app'  // 替换为你的Railway域名
}
```

### 💡 **其他免费选项**

| 平台 | 免费额度 | 优势 |
|------|----------|------|
| **Railway** | 500小时/月 | 推荐，最简单 |
| **Vercel** | 100GB带宽/月 | 快速，CDN加速 |
| **Render** | 750小时/月 | 稳定，功能丰富 |

### 💰 **费用对比**

| 方案 | 月费 | 年费 | 适用场景 |
|------|------|------|----------|
| **免费方案** | 0元 | 0元 | 个人学习、展示 |
| **云服务器** | 100-300元 | 1200-3600元 | 商业项目 |

---

## 🧠 AI智能系统

### 🎯 **AI算法架构**

#### 1. **核心算法**
- **Minimax算法**：博弈树搜索
- **Alpha-Beta剪枝**：优化搜索效率
- **启发式评估**：快速筛选候选位置
- **模式识别**：识别活四、活三等威胁

#### 2. **评估系统**
```python
# 评估权重（分数）
获胜机会: 100000分     # 最高优先级
活四机会: 80000分      # 几乎必选
防守活四: 40000分      # 必须防守
活三机会: 5000分       # 重要机会
防守活三: 3000分       # 威胁防御
```

#### 3. **智能特性**
- ✅ **获胜识别**：100%识别直接获胜机会
- ✅ **威胁检测**：准确识别活四、活三威胁
- ✅ **紧凑布局**：拒绝孤立位置，形成局部控制
- ✅ **攻防平衡**：既积极进攻，又不忽视防守

### 🎮 **难度等级详解**

#### 🟢 **简单模式（难度1）**
- **搜索深度**：2层
- **适合人群**：五子棋初学者
- **AI特点**：基础判断，容易被简单策略击败
- **获胜策略**：形成基本的三连、四连即可

#### 🔵 **普通模式（难度2）**
- **搜索深度**：3层
- **适合人群**：有一定经验的休闲玩家
- **AI特点**：能识别基本威胁，有一定防守能力
- **获胜策略**：需要考虑多步组合

#### 🟡 **困难模式（难度3）**
- **搜索深度**：4层
- **适合人群**：有经验的五子棋爱好者
- **AI特点**：强化威胁识别，不再"笨拙"
- **获胜策略**：需要深入思考和布局

#### 🟠 **专家模式（难度4）**
- **搜索深度**：6层
- **适合人群**：五子棋高手
- **AI特点**：很少错过获胜机会，防守严密
- **获胜策略**：需要精密计算和陷阱设置

#### 🔴 **大师模式（难度5）**
- **搜索深度**：8层
- **适合人群**：顶级玩家挑战
- **AI特点**：接近完美的决策，极难战胜
- **获胜策略**：需要大师级的战术理解

### 🎯 **AI改进历程**

#### 版本1：基础AI
- ❌ 经常错过获胜机会
- ❌ 下棋松散，缺乏重点
- ❌ 对威胁反应迟钝

#### 版本2：智能升级
- ✅ 搜索深度大幅提升
- ✅ 增强模式识别能力
- ✅ 改进评估函数

#### 版本3：获胜识别（当前）
- ✅ 100%识别获胜机会
- ✅ 准确识别活四、活三
- ✅ 紧凑布局，拒绝散乱
- ✅ 攻防平衡，策略清晰

---

## 🎲 游戏功能详解

### 🎯 **按钮功能说明**

#### 1. **新游戏**
- **功能**：创建全新的游戏会话
- **效果**：
  - 重置棋盘为空
  - 玩家先手（黑子）
  - 恢复提示次数为1
  - 应用当前选择的AI难度

#### 2. **重置**
- **功能**：重置当前游戏到初始状态
- **效果**：
  - 保持相同游戏会话
  - 清空棋盘
  - 恢复提示次数为1
  - 保持AI难度设置

#### 3. **提示(1)**
- **功能**：获取AI推荐的最佳落子位置
- **限制**：每局只能使用1次
- **使用条件**：
  - 必须是玩家回合
  - 游戏未结束
  - 还有剩余次数
- **显示效果**：在棋盘上标出推荐位置

#### 4. **同步**
- **功能**：手动同步前后端游戏状态
- **使用场景**：
  - 出现"not player turn"错误
  - 网络连接异常后
  - 棋盘状态不一致时
- **效果**：从服务器重新获取正确状态

### 🎛️ **设置选项说明**

#### 1. **AI难度**
- **调整时机**：游戏结束后或新游戏前
- **效果**：影响AI的思考深度和决策质量
- **建议**：
  - 初学者：简单或普通
  - 有经验：困难
  - 高手：专家或大师

#### 2. **AI速度**
- **调整时机**：随时可调整
- **效果**：控制AI思考时间长短
- **选择建议**：
  - 学习模式：慢速或深思（观察AI思考）
  - 快速对局：极速或快速
  - 平衡体验：普通

### 🎨 **界面优化特性**

#### 1. **避开棋盤的弹窗**
- **问题解决**：防止弹窗遮挡AI落子位置
- **设计原理**：所有提示都在棋盘上方显示
- **应用范围**：
  - AI提示反馈
  - 错误信息提示
  - 操作确认信息

#### 2. **AI落子高亮**
- **特殊动画**：AI落子时的炫酷高亮效果
- **信息显示**：显示落子位置和思考时间
- **持续时间**：3秒自动消失
- **样式特点**：渐变背景，脉冲动画

---

## 🔧 常见问题解决

### 🌐 **网络连接问题**

#### 问题1：显示"网络请求失败"
**原因**：微信小程序网络安全限制

**解决方案**：
1. **微信开发者工具设置**：
   - 勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"
   - 勾选"启用调试"

2. **检查服务器**：
```bash
# 确认服务器运行
python miniprogram.py
# 应显示：Running on http://127.0.0.1:5001
```

3. **配置文件检查**：
```json
// miniprogram/project.config.json
{
  "setting": {
    "urlCheck": false  // 必须设置为false
  }
}
```

#### 问题2：端口被占用
**错误信息**：`Address already in use`

**解决方案**：
```bash
# 查找占用端口的进程
lsof -ti:5001

# 终止进程
kill -9 <进程ID>

# 或者关闭macOS的AirPlay接收器
# 系统偏好设置 -> 通用 -> 隔空投送与接力 -> 关闭隔空播放接收器
```

### 🎮 **游戏逻辑问题**

#### 问题1："not player turn" 错误
**症状**：点击落子时提示"不是玩家回合"

**原因**：前后端状态不同步

**解决方案**：
1. **立即解决**：点击"同步"按钮
2. **预防措施**：
   - 避免快速连续点击
   - 等待AI完成落子再操作
   - 网络异常时使用同步功能

#### 问题2："invalid move" 错误
**症状**：落子被拒绝，提示"无效移动"

**原因**：
- 位置已有棋子
- 前后端棋盘状态不一致

**解决方案**：
1. **检查位置**：确认点击位置为空
2. **同步状态**：点击"同步"按钮
3. **重新落子**：选择其他空位

#### 问题3：游戏结束弹窗无法关闭
**症状**：点击新游戏后弹窗不消失

**状态**：已修复 ✅
- 替换了过时的modal组件
- 使用自定义弹窗实现
- 确保正确的事件处理

### 📱 **微信小程序问题**

#### 问题1：开发者工具配置
**必需设置**：
```
本地设置：
☑️ 不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书
☑️ 启用调试
☑️ 启用热重载
```

#### 问题2：真机调试
**注意事项**：
- 真机无法访问localhost
- 需要部署到云服务器
- 或使用内网IP地址

**内网调试方案**：
```javascript
// 修改 app.js
serverUrl: 'http://192.168.1.100:5001'  // 替换为你的内网IP
```

---

## 🏗️ 技术架构

### 🖥️ **后端架构（Python Flask）**

#### 1. **核心文件结构**
```
后端文件：
├── miniprogram.py        # 主服务器文件，API路由
├── game_logic.py         # 游戏逻辑，棋盘管理
├── ai_player.py          # AI算法，智能决策
├── config.py             # 配置文件
├── requirements.txt      # 依赖包列表
└── run.py               # 启动脚本
```

#### 2. **API接口**
```python
# 主要API端点
POST /api/new_game        # 创建新游戏
POST /api/make_move       # 玩家落子
GET  /api/get_board_state # 获取棋盘状态
POST /api/reset_game      # 重置游戏
GET  /api/ai_hint         # 获取AI提示
GET  /api/health          # 健康检查
```

#### 3. **数据结构**
```python
# 游戏会话
game_sessions = {
    'game_id': {
        'game': GomokuGame(),     # 游戏实例
        'ai': GomokuAI(),         # AI实例
        'created_at': timestamp,   # 创建时间
        'hint_used': False        # 提示使用状态
    }
}
```

### 📱 **前端架构（微信小程序）**

#### 1. **文件结构**
```
小程序文件：
├── app.js                # 全局逻辑，API调用
├── app.json              # 全局配置
├── app.wxss              # 全局样式
├── project.config.json   # 项目配置
└── pages/game/           # 游戏页面
    ├── game.js           # 页面逻辑
    ├── game.json         # 页面配置
    ├── game.wxml         # 页面结构
    └── game.wxss         # 页面样式
```

#### 2. **数据流**
```
用户操作 → 前端事件 → API请求 → 后端处理 → 响应数据 → 界面更新
```

#### 3. **状态管理**
```javascript
// 主要状态
data: {
    gameId: null,           // 游戏会话ID
    board: [],              // 棋盘状态
    currentPlayer: 1,       // 当前玩家
    gameOver: false,        // 游戏结束状态
    hintsRemaining: 1,      // 剩余提示次数
    difficultyIndex: 2,     // AI难度
    speedIndex: 2           // AI速度
}
```

### 🔄 **通信协议**

#### 1. **API请求格式**
```javascript
// 落子请求
{
    "game_id": "uuid",
    "row": 7,
    "col": 7,
    "ai_speed": 2
}
```

#### 2. **API响应格式**
```javascript
// 成功响应
{
    "success": true,
    "board_state": {...},
    "ai_move": {"row": 6, "col": 8},
    "ai_thinking_time": 1.5,
    "message": "操作成功"
}

// 错误响应
{
    "success": false,
    "error": "error_code",
    "message": "错误描述"
}
```

---

## 💻 开发指南

### 🛠️ **开发环境搭建**

#### 1. **后端环境**
```bash
# Python 3.7+ 
python --version

# 安装依赖
pip install -r requirements.txt

# 启动开发服务器
python miniprogram.py
```

#### 2. **前端环境**
1. 下载微信开发者工具
2. 导入项目中的 `miniprogram` 目录
3. 配置开发设置（不校验域名等）

#### 3. **开发工具**
- **后端调试**：Python调试器，Postman测试API
- **前端调试**：微信开发者工具内置调试器
- **代码编辑**：VS Code + Python插件

### 🧪 **测试指南**

#### 1. **后端测试**
```bash
# 运行单元测试
python test_game.py

# API健康检查
python diagnose_game.py

# 手动API测试
curl http://localhost:5001/api/health
```

#### 2. **前端测试**
- 微信开发者工具模拟器测试
- 真机预览测试
- 不同网络环境测试

#### 3. **集成测试**
- 完整游戏流程测试
- 网络异常处理测试
- 边界条件测试

### 📝 **代码规范**

#### 1. **Python代码规范**
```python
# 函数命名：蛇形命名
def get_best_move(self, game):
    pass

# 类命名：帕斯卡命名
class GomokuAI:
    pass

# 常量：大写下划线
MAX_SEARCH_DEPTH = 8
```

#### 2. **JavaScript代码规范**
```javascript
// 变量命名：驼峰命名
const gameId = this.data.gameId;

// 函数命名：驼峰命名，动词开头
onGetHint() {
    // ...
}

// 常量：大写下划线
const API_BASE_URL = 'https://api.example.com';
```

### 🔧 **扩展开发**

#### 1. **添加新功能**
```python
# 后端添加新API
@app.route('/api/new_feature', methods=['POST'])
def new_feature():
    # 实现逻辑
    pass
```

```javascript
// 前端调用新API
app.newFeature((error, result) => {
    // 处理结果
});
```

#### 2. **AI算法改进**
- 修改 `ai_player.py` 中的评估函数
- 调整搜索深度或剪枝策略
- 添加新的模式识别

#### 3. **界面优化**
- 修改 WXSS 样式文件
- 添加新的交互动画
- 优化用户体验

---

## 📈 更新日志

### 🎯 **版本 3.0 - 完美体验版（当前）**

#### 🎨 **界面优化**
- ✅ **避开棋盘的弹窗**：所有提示不再遮挡棋盘
- ✅ **AI落子高亮**：炫酷动画显示AI落子位置
- ✅ **自定义Toast**：美观的提示样式

#### 🎯 **提示系统限制**
- ✅ **每局限用1次**：增加游戏策略性
- ✅ **智能状态管理**：前后端完全同步
- ✅ **友好错误提示**：清晰的使用限制说明

#### 📚 **文档整合**
- ✅ **完整说明文档**：整合所有功能说明
- ✅ **详细故障排除**：常见问题完整解决方案
- ✅ **部署指南完善**：免费部署详细步骤

### 🧠 **版本 2.5 - AI智能升级版**

#### 🎯 **AI获胜识别大提升**
- ✅ **100%识别获胜机会**：不再错过活四、活三
- ✅ **智能威胁检测**：准确识别各种威胁模式
- ✅ **紧凑布局策略**：拒绝松散下棋

#### ⚡ **AI算法优化**
- ✅ **搜索深度提升**：各难度深度大幅提升
- ✅ **评估函数改进**：活四权重提升800倍
- ✅ **候选位置筛选**：智能筛选有价值位置

### 🎮 **版本 2.0 - 功能完善版**

#### 🔧 **核心功能**
- ✅ **AI速度控制**：5种思考速度可选
- ✅ **状态同步系统**：解决网络问题导致的状态错误
- ✅ **错误处理完善**：友好的错误提示和恢复机制

#### 🛠️ **技术改进**
- ✅ **网络问题解决**：完善的重试和超时机制
- ✅ **界面交互优化**：防止重复点击，状态反馈
- ✅ **兼容性提升**：支持不同版本微信开发者工具

### 🎯 **版本 1.0 - 基础版**

#### 🏗️ **基础架构**
- ✅ **Flask后端服务**：完整的API系统
- ✅ **微信小程序前端**：基础游戏界面
- ✅ **五子棋游戏逻辑**：标准规则实现

#### 🤖 **AI系统**
- ✅ **Minimax算法**：基础AI决策
- ✅ **5个难度等级**：从简单到大师
- ✅ **提示功能**：AI推荐最佳位置

---

## 🎉 总结

### 🌟 **项目亮点**
1. **🧠 智能AI**：从"笨拙"到"聪明"的完美蜕变
2. **🎮 完整功能**：五子棋游戏的所有必需功能
3. **🆓 免费部署**：零成本发布到微信平台
4. **🎨 用户体验**：避开棋盘的弹窗，清晰的状态反馈
5. **🔧 技术完善**：稳定的架构，完善的错误处理

### 🚀 **技术成就**
- **前后端分离**：清晰的架构设计
- **智能AI算法**：先进的博弈树搜索
- **完善错误处理**：网络异常的全面应对
- **用户体验优化**：从技术角度解决用户痛点

### 🎯 **使用建议**

#### 👶 **新手玩家**
- 选择"简单"或"普通"难度
- AI速度设为"快速"
- 善用提示功能学习

#### 🎮 **有经验玩家**
- 挑战"困难"或"专家"难度
- AI速度设为"普通"或"慢速"
- 观察AI思路，提升技巧

#### 🏆 **高手玩家**
- 挑战"大师"难度
- AI速度设为"深思"
- 慎重使用提示，追求完美对局

---

**🎮 现在就开始你的五子棋AI挑战之旅吧！无论是学习、娱乐还是挑战，这个小程序都能满足你的需求！** 

**🚀 部署到云端，与朋友分享你的五子棋AI小程序！**